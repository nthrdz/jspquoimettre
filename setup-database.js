// Script de configuration de la base de donn√©es Supabase
const SUPABASE_CONFIG = require('./supabase-config.js')

console.log('üîß Configuration de la base de donn√©es Supabase')
console.log('===============================================')

async function setupDatabase() {
    try {
        const { createClient } = require('@supabase/supabase-js')
        const supabase = createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.serviceRoleKey)
        
        console.log('üìã Instructions pour cr√©er la table profiles :')
        console.log('')
        console.log('1. Allez sur https://supabase.com/dashboard')
        console.log('2. S√©lectionnez votre projet')
        console.log('3. Allez dans "SQL Editor"')
        console.log('4. Ex√©cutez cette requ√™te SQL :')
        console.log('')
        console.log('```sql')
        console.log('-- Cr√©er la table profiles')
        console.log('CREATE TABLE IF NOT EXISTS public.profiles (')
        console.log('    id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,')
        console.log('    username TEXT UNIQUE NOT NULL,')
        console.log('    display_name TEXT NOT NULL,')
        console.log('    sport TEXT NOT NULL,')
        console.log('    plan TEXT DEFAULT \'FREE\',')
        console.log('    is_public BOOLEAN DEFAULT true,')
        console.log('    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),')
        console.log('    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()')
        console.log(');')
        console.log('')
        console.log('-- Activer RLS (Row Level Security)')
        console.log('ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;')
        console.log('')
        console.log('-- Politique pour permettre aux utilisateurs de voir leur propre profil')
        console.log('CREATE POLICY "Users can view own profile" ON public.profiles')
        console.log('    FOR SELECT USING (auth.uid() = id);')
        console.log('')
        console.log('-- Politique pour permettre aux utilisateurs de modifier leur propre profil')
        console.log('CREATE POLICY "Users can update own profile" ON public.profiles')
        console.log('    FOR UPDATE USING (auth.uid() = id);')
        console.log('')
        console.log('-- Politique pour permettre aux utilisateurs de cr√©er leur propre profil')
        console.log('CREATE POLICY "Users can insert own profile" ON public.profiles')
        console.log('    FOR INSERT WITH CHECK (auth.uid() = id);')
        console.log('')
        console.log('-- Politique pour permettre aux utilisateurs de supprimer leur propre profil')
        console.log('CREATE POLICY "Users can delete own profile" ON public.profiles')
        console.log('    FOR DELETE USING (auth.uid() = id);')
        console.log('')
        console.log('-- Politique pour permettre la lecture des profils publics')
        console.log('CREATE POLICY "Public profiles are viewable by everyone" ON public.profiles')
        console.log('    FOR SELECT USING (is_public = true);')
        console.log('```')
        console.log('')
        console.log('5. Cliquez sur "Run" pour ex√©cuter la requ√™te')
        console.log('')
        console.log('‚úÖ Une fois la table cr√©√©e, relancez : node test-supabase.js')
        
    } catch (error) {
        console.error('‚ùå Erreur:', error.message)
    }
}

setupDatabase()
